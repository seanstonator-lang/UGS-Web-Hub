<!DOCTYPE html>


<!-- Ultimate Game Stash file--> 
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ -->


<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Burrito Bison</title>
    
    <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/BurritoBison-main/">
    
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
        }
        
        /* FIXED: Changed ID to match the div below (#gameContainer) */
        #gameContainer {
            width: 100% !important;
            height: 100% !important;
            position: absolute;
            top: 0;
            left: 0;
            margin: 0 !important;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Force canvas inside gameContainer to fit */
        #gameContainer canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>

    <script>
      window.fileMergerConfig = {
        files: [
          // Only include files here that are ACTUALLY split into .part1, .part2
          { name: 'burrito-bison-ll.data.unityweb', parts: 2 }, 
          { name: 'burrito-bison-ll.asm.code.unityweb', parts: 2 },
          { name: 'burrito-bison-ll.asm.memory.unityweb', parts: 1 },
          { name: 'burrito-bison-ll.asm.framework.unityweb', parts: 1 },
          // REMOVED framework and memory. 
          // Only add them back if you actually split them into .part1 files.
          // If they are standard files <50MB, let the browser load them normally.
        ],
        basePath: '', 
        debug: true
      };  
    </script>

    <script>
    (function() {
      'use strict';
      const defaultConfig = { files: [], basePath: '', debug: true };
      const config = Object.assign({}, defaultConfig, window.fileMergerConfig || {});
      window.mergedFiles = window.mergedFiles || {};
      const mergeStatus = {};

      function log(...args) { if (config.debug) console.log('[FileMerger]', ...args); }
      function error(...args) { console.error('[FileMerger]', ...args); }

      function normalizeUrl(url) {
        try { return decodeURIComponent(url.toString().split('?')[0]); } catch (e) { return url; }
      }

      function urlsMatch(url1, url2) {
        const norm1 = normalizeUrl(url1);
        const norm2 = normalizeUrl(url2);
        if (norm1 === norm2) return true;
        if (norm1.endsWith(norm2) || norm2.endsWith(norm1)) return true;
        return norm1.split('/').pop() === norm2.split('/').pop();
      }

      async function mergeSplitFiles(filePath, numParts) {
        try {
          const parts = [];
          for (let i = 1; i <= numParts; i++) parts.push(`${filePath}.part${i}`);
          log(`Merging ${filePath} from ${numParts} parts...`);
          const responses = await Promise.all(parts.map(part => window.originalFetch(part)));
          
          for (let i = 0; i < responses.length; i++) {
            if (!responses[i].ok) throw new Error(`Failed to load ${parts[i]}: ${responses[i].status}`);
          }

          const buffers = await Promise.all(responses.map(r => r.arrayBuffer()));
          const totalSize = buffers.reduce((sum, buf) => sum + buf.byteLength, 0);
          const mergedArray = new Uint8Array(totalSize);
          let offset = 0;
          for (const buffer of buffers) {
            mergedArray.set(new Uint8Array(buffer), offset);
            offset += buffer.byteLength;
          }
          log(`âœ… ${filePath} merged (${(totalSize/1024/1024).toFixed(2)} MB)`);
          return mergedArray.buffer;
        } catch (err) {
          error(`Failed to merge ${filePath}:`, err);
          throw err;
        }
      }

      function shouldInterceptFile(url) {
        const urlStr = normalizeUrl(url);
        if (urlStr.includes('.part')) return null;
        for (const file of config.files) {
          const fileName = file.name;
          const fullPath = config.basePath ? `${config.basePath}${fileName}` : fileName;
          if (urlsMatch(urlStr, fileName) || urlsMatch(urlStr, fullPath)) return fileName;
        }
        return null;
      }

      function getMergedFile(filename) {
        if (window.mergedFiles[filename]) return window.mergedFiles[filename];
        for (const [key, value] of Object.entries(window.mergedFiles)) {
          if (urlsMatch(key, filename)) return value;
        }
        return null;
      }

      if (!window.originalFetch) window.originalFetch = window.fetch;
      window.fetch = function(url, ...args) {
        const filename = shouldInterceptFile(url);
        if (filename) {
          log('Intercepting fetch:', filename);
          return new Promise((resolve, reject) => {
            const check = setInterval(() => {
              const buffer = getMergedFile(filename);
              if (buffer) {
                clearInterval(check);
                resolve(new Response(buffer, { status: 200 }));
              } else if (mergeStatus[filename] === 'failed') {
                clearInterval(check); reject(new Error('Merge failed'));
              }
            }, 100);
          });
        }
        return window.originalFetch.call(this, url, ...args);
      };

      if (!window.OriginalXMLHttpRequest) window.OriginalXMLHttpRequest = window.XMLHttpRequest;
      window.XMLHttpRequest = function(options) {
        const xhr = new window.OriginalXMLHttpRequest(options);
        const originalOpen = xhr.open;
        const originalSend = xhr.send;
        let requestUrl = '';
        xhr.open = function(method, url, ...args) {
          requestUrl = url;
          return originalOpen.call(this, method, url, ...args);
        };
        xhr.send = function(...args) {
          const filename = shouldInterceptFile(requestUrl);
          if (filename) {
            log('Intercepting XHR:', filename);
            const waitForMerge = () => {
              const buffer = getMergedFile(filename);
              if (buffer) {
                Object.defineProperties(xhr, {
                  status: { value: 200 },
                  response: { value: buffer },
                  readyState: { value: 4 }
                });
                setTimeout(() => {
                   if(xhr.onreadystatechange) xhr.onreadystatechange();
                   if(xhr.onload) xhr.onload({ type: 'load', target: xhr });
                }, 10);
              } else if (mergeStatus[filename] === 'failed') {
                 if(xhr.onerror) xhr.onerror(new Error('Merge failed'));
              } else { setTimeout(waitForMerge, 100); }
            };
            waitForMerge();
            return;
          }
          return originalSend.call(this, ...args);
        };
        return xhr;
      };

      async function autoMergeFiles() {
        if (!config.files.length) return;
        config.files.forEach(file => {
          const fullPath = config.basePath ? `${config.basePath}${file.name}` : file.name;
          mergeStatus[file.name] = 'merging';
          mergeSplitFiles(fullPath, file.parts).then(buffer => {
            window.mergedFiles[file.name] = buffer;
            window.mergedFiles[fullPath] = buffer;
            mergeStatus[file.name] = 'ready';
          }).catch(() => mergeStatus[file.name] = 'failed');
        });
      }
      autoMergeFiles();
    })();
    </script>

    <link rel="stylesheet" href="style.css">
    <script src="UnityProgress.js"></script>
    <script src="burrito-bison-ll.js"></script> 
    <script src="kongregate_api.js"></script>
    
    <script>
      var gameInstance = UnityLoader.instantiate("gameContainer", "burrito-bison-ll.json", {
          onProgress: UnityProgress,
          Module: {
              onRuntimeInitialized: function() {
                  UnityProgress(gameInstance, "complete");
              }
          }
      });
    </script>
</head>
<body>
    <div class="webgl-content" style="width: 100%; height: 100%;">
        <div id="gameContainer" style="width: 100%; height: 100%;"></div>
    </div> 
</body>
</html>