<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | LevelUpMMM</title>
  <base href="https://cdn.jsdelivr.net/gh/deformed-steve/The-Cheese-Stash@main/games/mmm/">
  <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/deformed-steve/The-Cheese-Stash@main/games/mmm/TemplateData/favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/deformed-steve/The-Cheese-Stash@main/games/mmm/TemplateData/style.css">
</head>

<body>
  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>
    <div id="unity-warning"> </div>
    <div id="unity-footer">
      <div id="unity-webgl-logo"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">LevelUpMMM</div>
    </div>
  </div>
  <script>
    var container = document.querySelector("#unity-container");
    var canvas = document.querySelector("#unity-canvas");
    var loadingBar = document.querySelector("#unity-loading-bar");
    var progressBarFull = document.querySelector("#unity-progress-bar-full");
    var fullscreenButton = document.querySelector("#unity-fullscreen-button");
    var warningBanner = document.querySelector("#unity-warning");

    // Shows a temporary message banner/ribbon for a few seconds, or
    // a permanent error message on top of the canvas if type=='error'.
    // If type=='warning', a yellow highlight color is used.
    // Modify or remove this function to customize the visually presented
    // way that non-critical warnings and error messages are presented to the
    // user.
    function unityShowBanner(msg, type) {
      function updateBannerVisibility() {
        warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
      }
      var div = document.createElement('div');
      div.innerHTML = msg;
      warningBanner.appendChild(div);
      if (type == 'error') div.style = 'background: red; padding: 10px;';
      else {
        if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
        setTimeout(function() {
          warningBanner.removeChild(div);
          updateBannerVisibility();
        }, 5000);
      }
      updateBannerVisibility();
    }
async function fetchAndMerge(baseUrl, count, extension) {
    const parts = [];
    for (let i = 1; i <= count; i++) {
        parts.push(fetch(`${baseUrl}.${extension}.part${i}`).then(res => {
            if (!res.ok) throw new Error(`Failed to fetch part ${i} of ${extension}`);
            return res.arrayBuffer();
        }));
    }
    const buffers = await Promise.all(parts);
    const combinedBlob = new Blob(buffers, { type: "application/octet-stream" });
    return URL.createObjectURL(combinedBlob);
}
// ... existing variables (container, canvas, etc.) ...

var buildUrl = "https://cdn.jsdelivr.net/gh/deformed-steve/The-Cheese-Stash@main/games/mmm/Build";
var loaderUrl = buildUrl + "/WebGL.loader.js";

// We will populate these URLs dynamically
var config = {
    dataUrl: "", 
    frameworkUrl: buildUrl + "/WebGL.framework.js",
    codeUrl: "",
    streamingAssetsUrl: "https://cdn.jsdelivr.net/gh/deformed-steve/The-Cheese-Stash@main/games/mmm/StreamingAssets",
    companyName: "Roombie _ BookwormKevin",
    productName: "LevelUpMMM",
    productVersion: "1.2",
    showBanner: unityShowBanner,
};

var script = document.createElement("script");
script.src = loaderUrl;
script.onload = async () => {
    try {
        // Merge the WASM parts (1-3)
        const mergedWasm = await fetchAndMerge(`${buildUrl}/WebGL`, 3, "wasm");
        // Merge the DATA parts (1-4)
        const mergedData = await fetchAndMerge(`${buildUrl}/WebGL`, 4, "data");

        config.codeUrl = mergedWasm;
        config.dataUrl = mergedData;

        createUnityInstance(canvas, config, (progress) => {
            progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
            loadingBar.style.display = "none";
            fullscreenButton.onclick = () => {
                unityInstance.SetFullscreen(1);
            };
        }).catch((message) => {
            alert(message);
        });
    } catch (err) {
        console.error("Error merging files:", err);
        alert("Failed to load game assets.");
    }
};

document.body.appendChild(script);
  </script>
</body>

</html>